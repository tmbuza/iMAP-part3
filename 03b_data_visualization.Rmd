# Data Visualization

## Load data
```{r}
source("R/common.R")
load("RDataRDS/phyloseq_objects.RData", verbose = T)
```


## Phyloseq stacked barcharts
- Here we are using `metaphlan` output `ps_m3_rel object` generated from simulated sequencing data.
- The plots are stacked by animation.

```{r ps_abund_bar, fig.height=10, fig.width=10, animation.hook='gifski'}
ps_rel <- ps_q2_rel

# Kingdom
phyloseq::plot_bar(ps_rel, fill = "kingdom") +
  geom_bar(aes(color = kingdom, fill = kingdom), stat = "identity", position = "stack") +
  labs(x = "", y = "Relative Abundance\n") +
  facet_wrap(~ ecosystem, scales = "free") +
  theme(panel.background = element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) +
  # nolegend +
  labs(title = "Kingdom abundance") + 
  centertitle 

# phylum
phyloseq::plot_bar(ps_rel, fill = "phylum") +
  geom_bar(aes(color = phylum, fill = phylum), stat = "identity", position = "stack") +
  labs(x = "", y = "Relative Abundance\n") +
  facet_wrap(~ ecosystem, scales = "free") +
  theme(panel.background = element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) + 
  #nolegend +
  labs(title = "Phylum abundance") + 
  centertitle

# class
phyloseq::plot_bar(ps_rel, fill = "class") +
  geom_bar(aes(color = class, fill = class), stat = "identity", position = "stack") +
  labs(x = "", y = "Relative Abundance\n") +
  facet_wrap(~ ecosystem, scales = "free") +
  theme(panel.background = element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) + 
  # nolegend +
  labs(title = "Class abundance") + 
  centertitle 

# order
phyloseq::plot_bar(ps_rel, fill = "order") +
  geom_bar(aes(color = order, fill = order), stat = "identity", position = "stack") +
  labs(x = "", y = "Relative Abundance\n") +
  facet_wrap(~ ecosystem, scales = "free") +
  theme(panel.background = element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) + 
  # nolegend +
  labs(title = "Order abundance") + 
  centertitle

# family    
phyloseq::plot_bar(ps_rel, fill = "family") +
  geom_bar(aes(color = family, fill = family), stat = "identity", position = "stack") +
  labs(x = "", y = "Relative Abundance\n") +
  facet_wrap(~ ecosystem, scales = "free") +
  theme(panel.background = element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) + 
  # nolegend +
  labs(title = "Family abundance") + 
  centertitle

# genus   
phyloseq::plot_bar(ps_rel, fill = "genus") +
  geom_bar(aes(color = genus, fill = genus), stat = "identity", position = "stack") +
  labs(x = "", y = "Relative Abundance\n") +
  facet_wrap(~ ecosystem, scales = "free") +
  theme(panel.background = element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) + 
  # nolegend +
  labs(title = "Genus abundance") + 
  centertitle
```